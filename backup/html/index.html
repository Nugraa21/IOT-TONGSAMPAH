<!DOCTYPE html>
<html lang="en">
<head>  
  <style>
    :root {
    --font-family: 'Arial', sans-serif;
    --font-size: 16px;
  }
  
  /* Light mode variables */
  :root.light-mode {
    --bg-color: #f5f5f5;
    --text-color: #222222;
    --button-bg: #4caf50;
    --button-text: #ffffff;
  }
  
  /* Dark mode variables */
  :root.dark-mode {
    --bg-color: #121212;
    --text-color: #e0e0e0;
    --button-bg: #ff5722;
    --button-text: #000000;
  }
  
/* Main body  */

/* #map { height: 500px; } */
.status-full { color: red; font-weight: bold; }
.status-empty { color: green; font-weight: bold; }
.leaflet-popup-content {
  font-size: 14px;
  font-weight: bold;
}
.marker-full {
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.687);
  background-color: red;
  color: white;
  border-radius: 50%;
  padding: 5px;
}
.marker-empty {
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.687);
  background-color: green;
  color: white;
  border-radius: 50%;
  padding: 5px;
}
/* -------------------------------------------------------------------------------------- */
.cart-row{
  padding: 1rem;
  display: block;
  align-items: center;
  justify-content: space-between;
  background-color: #f8dbdb;
  border-radius: 5px;
}
.cart{
  display: block;
  align-items: center;
  justify-content: space-between;
  padding: 10px;
  margin: 10px;
  background-color: #fff;
  border-radius: 5px;
  border: 2px solid rgb(255, 177, 177);
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.317);
}
.cart-alamat{
  padding: 5px;
  border-left: 2px solid rgb(255, 177, 177);
  background-color: #ff9c9c23;
}
.cart-row-logo{
  display: flex;
  gap: 12rem;
}
/* ----------------------------------------- */
button{
  font-size: 20px;
  align-items: center;
  justify-content: center;
  background-color: rgb(255, 222, 216);
  margin: 10px;
  padding: 7px;
  border-radius: 10px;
  color: #000000;
  border: none;
  /* border-bottom: #ff0000; */
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.147);
}
button:hover{
  background-color: rgb(255, 255, 255);
  border-radius: 10px;
  color: tomato;
  border: none;}
/* ----------------------------------------- */


body {
  font-family: Arial, sans-serif;
  background-color: #ff6347;
  margin: 0;
  padding: 0;
  color: white;
}

header {
  background-color: #c74d35;
  padding: 10px 0;
  text-align: center;
}

header h1 {
  font-size: 2em;
}

.container {
  padding-top: 30px;
  display: flex;
  justify-content: space-between;
  margin: 20px;
  flex-wrap: wrap;
}

.info {
  max-width: 100%;
  width: 30%;
  padding: 20px;
  background-color: #f9f9f9;
  color: #333;
  border-radius: 10px;
  align-items: center;
}
.info h2{
  font-size: 35px;
  /* background-color: #000000; */
  border-bottom: 2px solid #c06250;
}

.map-container {
  width: 65%;
  height: 830px;
  border: 5px solid #c74d35;
  border-radius: 20px;
}

.status {
  padding: 10px;
  margin-top: 10px;
  background-color: #c74d35;
  color: white;
  border-radius: 5px;
}

.status-full {
  background-color: #ff0000;
}

.status-empty {
  background-color: #2e8b57;
}

/* ------------- */
/* Media query untuk layar kecil (max-width: 768px) */
@media (max-width: 768px) {
  body{
    min-height: 300px;
  }
  .container {
    flex-direction: column;
    align-items: center;
    margin: 10px;
  }

  .info, 
  .map-container {
    width: 100%;
    margin-bottom: 20px;
  }

  .info {
    padding: 10px;
    font-size: 16px;
  }

  .info h2 {
    font-size: 25px;
  }

  .map-container {
    height: 400px;
    border-width: 5px;
  }

  .cart {
    margin: 5px;
    padding: 5px;
    font-size: 14px;
  }

  .cart-row {
    padding: 0.5rem;
    font-size: 12px;
  }

  .cart-alamat {
    padding: 2px;
    font-size: 12px;
  }

  button {
    font-size: 16px;
    padding: 5px;
    margin: 5px;
  }

  header h1 {
    font-size: 1.5em;
  }

  .status {
    font-size: 14px;
    padding: 8px;
  }
}

  </style>
    <!-- !!!!!!!!!!!!!!!!!!!!!!! -->
     
    <!-- css framwork  -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    

    <!-- !!!!!!!!!!!!!!!!!!!!!!! -->
    <!-- ---------- css ---------- -->
    <link rel="stylesheet" href="assets/css/styles.css"> 
    <link rel="stylesheet" href="assets/css/responsif.css">
    <!-- ---------- icon ---------- -->
     <link rel="icon" href="assets/media/icon/code.png">
     <!-- ---------- Meta ---------- -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ---------- Title ---------- -->
    <title>IOT-SAMPAH</title>
</head>
<body>
<nav>
<!-- ------------------------------------------------------------------------------------------- -->
<div class="container">
  <div class="info">
    <h2><img width="30px" src="https://cdn-icons-png.flaticon.com/128/2514/2514330.png" alt=""> Status Tong Sampah</h2>
    <!-- cart -->
    <div class="cart-row">
      <!-- rumah 1 -->
      <div class="cart">
        <div class="cart-data">
          <div class="cart-row-logo">
            <h1><img width="30px" src="https://cdn-icons-png.flaticon.com/128/18397/18397677.png" alt=""> Rumah 1</h1>
            <div class="buttons">
              <button id="light-theme" onclick="location.href='https://maps.app.goo.gl/g2iWwM3xYWAd1wgC7'"><img width="15px" src="https://cdn-icons-png.flaticon.com/128/684/684908.png" alt="">Lihat lokasi</button>
          </div>
          </div>
          <div class="cart-alamat">
            <h4>alamat rumah </h4>
            <p>5CHG+HMR, Sekarsuli, Sendangtirto, Kec. Berbah, Kabupaten Sleman, Daerah Istimewa Yogyakarta 55573</p>
          </div>
        </div>
        <div class="cart-status">
          <div id="statusTongSampah1" class="status">Menunggu status...</div>
        </div>
      </div>
      <!-- rumah 2 -->
      <div class="cart">
        <div class="cart-data">
          <div class="cart-row-logo">
            <h1><img width="30px" src="https://cdn-icons-png.flaticon.com/128/18397/18397677.png" alt=""> Rumah 2</h1>
            <div class="buttons">
              <button id="light-theme" onclick="location.href='https://maps.app.goo.gl/2zHKCF3R3VQuNYzCA'"><img width="15px" src="https://cdn-icons-png.flaticon.com/128/684/684908.png" alt="">Lihat lokasi</button>
          </div>
          </div>
          <div class="cart-alamat">
            <h4>alamat rumah </h4>
            <p>5CHG+HMR, Sekarsuli, Sendangtirto, Kec. Berbah, Kabupaten Sleman, Daerah Istimewa Yogyakarta 55573</p>
          </div>
        </div>
        <div class="cart-status">
          <div id="statusTongSampah2" class="status">Menunggu status...</div>
        </div>
      </div>
            <!-- rumah 2 -->
            <div class="cart">
              <div class="cart-data">
                <div class="cart-row-logo">
                  <h1><img width="30px" src="https://cdn-icons-png.flaticon.com/128/18397/18397677.png" alt=""> Rumah 3</h1>
                  <div class="buttons">
                    <button id="light-theme" onclick="location.href=''"><img width="15px" src="https://cdn-icons-png.flaticon.com/128/684/684908.png" alt="">Lihat lokasi</button>
                </div>
                </div>
                <div class="cart-alamat">
                  <h4></h4>
                  <p></p>
                </div>
              </div>
              <div class="cart-status">
                <div id="statusTongSampah3" class="status">Belum ada </div>
              </div>
            </div>
      <!--  -->
    </div>
  </div>
  <!-- <div class="map-container"> -->
      <!-- <h1>dat dat dat dat </h1> -->
    <div id="map" class="map-container"></div>
  <!-- </div> -->
</div>

<!-- ------------------------------------------------------------------------------------------- -->
<!-- js  -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mqtt@4.3.7/dist/mqtt.min.js"></script>
  <!-- js  -->
<!-- <script src="assets/js/main.js"></script> -->
 <script>
      // Lokasi tong sampah
      const lokasiTongSampah1 = [-7.82062992849643, 110.42654669574745];
    const lokasiTongSampah2 = [-7.820135382837104, 110.42666630956253];

    // Inisialisasi peta
    const map = L.map('map').setView([-7.8204, 110.4266], 16); // Pusat peta

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Menambahkan marker untuk tong sampah
    const markerTongSampah1 = L.marker(lokasiTongSampah1, {
      icon: L.divIcon({ className: 'marker-empty', html: 'ðŸŸ¢' })
    }).addTo(map)
      .bindPopup('Tong Sampah 1')
      .openPopup();

    const markerTongSampah2 = L.marker(lokasiTongSampah2, {
      icon: L.divIcon({ className: 'marker-empty', html: 'ðŸŸ¢' })
    }).addTo(map)
      .bindPopup('Tong Sampah 2');

    // Inisialisasi MQTT
    const client = mqtt.connect('ws://broker.mqttdashboard.com:8000/mqtt');

    client.on('connect', function () {
      console.log('MQTT Connected');
      client.subscribe('tong_sampah_1/status');
      client.subscribe('tong_sampah_2/status');
    });

    client.on('message', function (topic, message) {
      const status = message.toString();
      
      if (topic === 'tong_sampah_1/status') {
        const statusElement = document.getElementById('statusTongSampah1');
        statusElement.textContent = 'Status: ' + status;
        if (status === 'Sudah Penuh') {
          statusElement.classList.add('status-full');
          statusElement.classList.remove('status-empty');
          markerTongSampah1.bindPopup('Tong Sampah 1 Penuh').openPopup();
          markerTongSampah1.setIcon(L.divIcon({ className: 'marker-full', html: 'ðŸ”´' }));
          playAlertSound();
        } else {
          statusElement.classList.add('status-empty');
          statusElement.classList.remove('status-full');
          markerTongSampah1.setIcon(L.divIcon({ className: 'marker-empty', html: 'ðŸŸ¢' }));
        }
      }

      if (topic === 'tong_sampah_2/status') {
        const statusElement = document.getElementById('statusTongSampah2');
        statusElement.textContent = 'Status: ' + status;
        if (status === 'Sudah Penuh') {
          statusElement.classList.add('status-full');
          statusElement.classList.remove('status-empty');
          markerTongSampah2.bindPopup('Tong Sampah 2 Penuh').openPopup();
          markerTongSampah2.setIcon(L.divIcon({ className: 'marker-full', html: 'ðŸ”´' }));
          playAlertSound();
        } else {
          statusElement.classList.add('status-empty');
          statusElement.classList.remove('status-full');
          markerTongSampah2.setIcon(L.divIcon({ className: 'marker-empty', html: 'ðŸŸ¢' }));
        }
      }
    });

    // Fungsi untuk memutar suara alert
    function playAlertSound() {
      const audio = new Audio('pilager.mp3');
      audio.play();
    }
 </script>
 <!-- js tema opsional -->
<script src="assets/js/tema.js"></script>
<!-- server -->
<script>
    const eventSource = new EventSource('http://localhost:3001/refresh');
    eventSource.onmessage = () => {
        location.reload();
    };
</script>
</body>
</html>

<!-- Data ! -->
<!-- <div class="container">
    <h1>Nugra.template</h1>
    <p>Template semantik code </p>
    
    <div class="buttons">
        <button id="light-theme">Light Mode</button>
        <button id="dark-theme">Dark Mode</button>
    </div>
</div> -->